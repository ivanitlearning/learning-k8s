# Qns

Some questions that arise while going through KodeKloud's course. To be updated periodically. These arise mostly from stream of consciousness musing, so don't expect it to be properly structured.

1. Difference between ReplicaSet and Deployment?

   * Deployment appears to support rollback eg. Change nginx version back to older one.

2. There seems to be no way to list the pods of a specific named deployment, is there? Only [by labels](https://stackoverflow.com/questions/52957227/kubectl-command-to-list-pods-of-a-deployment-in-kubernetes/52957569)?

   I could do this but I first need to find the exact label generated by k8s.

   ```text
   root@controlplane:~# kubectl get pods --show-labels
   NAME                                   READY   STATUS             RESTARTS   AGE     LABELS
   deployment-1-8598555cd4-97hsm          1/1     Running            0          6m46s   name=busybox-pod,pod-template-hash=8598555cd4
   deployment-1-8598555cd4-nhw4r          1/1     Running            0          6m42s   name=busybox-pod,pod-template-hash=8598555cd4
   frontend-deployment-56d8ff5458-gckj8   0/1     ImagePullBackOff   0          24m     name=busybox-pod,pod-template-hash=56d8ff5458
   frontend-deployment-56d8ff5458-rdqjr   0/1     ImagePullBackOff   0          24m     name=busybox-pod,pod-template-hash=56d8ff5458
   frontend-deployment-56d8ff5458-vw7fh   0/1     ImagePullBackOff   0          24m     name=busybox-pod,pod-template-hash=56d8ff5458
   frontend-deployment-56d8ff5458-zq4mp   0/1     ImagePullBackOff   0          24m     name=busybox-pod,pod-template-hash=56d8ff5458
   root@controlplane:~# kubectl get pods --selector=name=busybox-pod,pod-template-hash=8598555cd4
   NAME                            READY   STATUS    RESTARTS   AGE
   deployment-1-8598555cd4-97hsm   1/1     Running   0          12m
   deployment-1-8598555cd4-nhw4r   1/1     Running   0          12m
   ```

3. How does NodePort work for loadbalancing among multiple pods with same selector in a node?

4. In case you face problems trying to use the X11 display after switching to root with MobaXterm, [read this](https://blog.mobatek.net/post/how-to-keep-X11-display-after-su-or-sudo/)

5. Do `minikube start` when you start up the instance

6. How exactly do you use DS for monitoring software?

7. What exactly is `--leader-elect` used for in custom scheduler? How do I use it?

   1. The custom scheduler needs to have `--leader-elect=false` before it can be used to schedule pods. If not pods with schedulerName specified gets stuck in Pending.

8. Is there a way to upgrade kubeadm and kubelet on worker nodes without SSH to it from master?

9. Why are there extra steps in the solution demo for `etcdctl snapshot restore` not mentioned in the lecture?

10. The documentation for restoring etcdctl cluster [links to etcd.io](https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/), but this is outside kubernetes.io. Can use for exam?

11. In the etcdctl restore lab I omitted these arguments and could restore the svc and deploy, but the pod was still stuck in pending even after 10 min. Is this acceptable?

    ```text
    --inital-cluster="master"=https://127.0.0.1:2379
    --name="master"
    --inital-advertise-peer-urls="https://127.0.0.1:2380"
    --initial-cluster-token="etcd-cluster-1"
    ```

12. Try an etcdctl backup and restore in another lab to see if can work without the issues.

13. Review TLS certificates again, how to create and specify them (if needed for exam)

14. What exactly is cluster when specified in the KubeConfig file?

15. Learn what are API groups?

16. Why are API groups apps and extensions required for creating deployments?

17. How does podselector work for NetworkPolicy when applied to services? 

18. In the NetworkPolicy lab, this config didn't work until I changed "name" to "role". Why?

    ```yaml
    spec:
      podSelector:
        matchLabels:
          role: db
    ```

19. Why is the volumeMount specified together with PVC [in this example](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#claims-as-volumes)?

20. Why is the MAC address different for node01 in the lab Explore environment networking namespaces? 

    Qn: What is the MAC address assigned to `node01`?

    ```text
    root@controlplane:~# k get nodes -o wide
    NAME           STATUS   ROLES                  AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION   CONTAINER-RUNTIME
    controlplane   Ready    control-plane,master   9m6s    v1.20.0   10.24.246.3   <none>        Ubuntu 18.04.5 LTS   5.4.0-1053-gcp   docker://19.3.0
    node01         Ready    <none>                 8m16s   v1.20.0   10.24.246.6   <none>        Ubuntu 18.04.5 LTS   5.4.0-1056-gcp   docker://19.3.0
    
    root@controlplane:~# arp 10.24.246.6
    Address                  HWtype  HWaddress           Flags Mask            Iface
    k8-multi-node-ttyd-1-20  ether   02:42:0a:18:f6:06   C                     eth0
    root@controlplane:~# arp node01
    Address                  HWtype  HWaddress           Flags Mask            Iface
    10.24.246.5              ether   02:42:0a:18:f6:04   C                     eth0
    ```

    The address of the node interface is different. Why are there two?

21. For this question, how do you check it with respect to the service? path for CNI binaries are not specified.

    Qn: What is the path configured with all binaries of CNI supported plugins?

    ```text
    root@controlplane:~# ps aux | grep kubelet
    root      3916  0.0  0.1 1104196 353748 ?      Ssl  08:39   1:06 kube-apiserver --advertise-address=10.17.78.9 --allow-privileged=true --authorization-mode=Node,RBAC --client-ca-file=/etc/kubernetes/pki/ca.crt --enable-admission-plugins=NodeRestriction --enable-bootstrap-token-auth=true --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key --etcd-servers=https://127.0.0.1:2379 --insecure-port=0 --kubelet-client-certificate=/etc/kubernetes/pki/apiserver-kubelet-client.crt --kubelet-client-key=/etc/kubernetes/pki/apiserver-kubelet-client.key --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname --proxy-client-cert-file=/etc/kubernetes/pki/front-proxy-client.crt --proxy-client-key-file=/etc/kubernetes/pki/front-proxy-client.key --requestheader-allowed-names=front-proxy-client --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --requestheader-extra-headers-prefix=X-Remote-Extra- --requestheader-group-headers=X-Remote-Group --requestheader-username-headers=X-Remote-User --secure-port=6443 --service-account-issuer=https://kubernetes.default.svc.cluster.local --service-account-key-file=/etc/kubernetes/pki/sa.pub --service-account-signing-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --tls-cert-file=/etc/kubernetes/pki/apiserver.crt --tls-private-key-file=/etc/kubernetes/pki/apiserver.key
    root      4816  0.0  0.0 3855116 103824 ?      Ssl  08:40   0:28 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --network-plugin=cni --pod-infra-container-image=k8s.gcr.io/pause:3.2
    ```

22. When you describe a svc, whats the difference between ClusterIP and endpoint address?

    ```text
    root@controlplane:~# k describe svc kube-dns -n kube-system
    Name:              kube-dns
    Namespace:         kube-system
    Labels:            k8s-app=kube-dns
                       kubernetes.io/cluster-service=true
                       kubernetes.io/name=KubeDNS
    Annotations:       prometheus.io/port: 9153
                       prometheus.io/scrape: true
    Selector:          k8s-app=kube-dns
    Type:              ClusterIP
    IP Families:       <none>
    IP:                10.96.0.10
    IPs:               10.96.0.10
    Port:              dns  53/UDP
    TargetPort:        53/UDP
    Endpoints:         10.244.0.2:53,10.244.0.3:53
    Port:              dns-tcp  53/TCP
    TargetPort:        53/TCP
    Endpoints:         10.244.0.2:53,10.244.0.3:53
    Port:              metrics  9153/TCP
    TargetPort:        9153/TCP
    Endpoints:         10.244.0.2:9153,10.244.0.3:9153
    Session Affinity:  None
    Events:            <none>
    ```

23. Why do I need to specify annotations in the ingress lab config or it won't work? What are annotations?

    ```yaml
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      annotations:
        nginx.ingress.kubernetes.io/rewrite-target: /
        nginx.ingress.kubernetes.io/ssl-redirect: "false"
      name: ingress-wear-watch
      namespace: app-space
    ```

24. How to configure default-backend-http for ingress?

25. How do we know where the `--kubeconfig` option for kube-controller-manager is supposed to point to?

# Progress

* Done revision with topics
  * Application Lifecycle Management
  * Logging & Monitoring
  * Scheduling
  * Core Concepts
  * Security
* Currently done with sub-topic Cluster Upgrade Process, doing etcdctl

# Notes

Notes here don't fit into the main notes

1. kube-apiserver is available as a service and binary [only if installed directly](https://stackoverflow.com/questions/51666507/how-can-kube-apiserver-be-restarted?rq=1), otherwise it is provisioned as pod on namespace kube-system by kubeadm

2. You can enable autocomplete with alias k=kubectl [with this](https://kubernetes.io/docs/tasks/tools/included/optional-kubectl-configs-bash-linux/). Add these into **~/.bashrc** and `source ~/.bashrc` in **/etc/profile** if required

   ```bash
   alias k=kubectl
   complete -F __start_kubectl k
   soure <(kubectl completion bash)
   ```

3. Useful links for further study

   https://github.com/bmuschko/cka-study-guide

4. To make tmux use bash as a default shell edit ~/.tmux.conf to add (create one if non-existent)

   ```conf
   set-option -g default-shell /bin/bash
   ```

5. Some keys for tmux

   ```text
   Ctrl-b " # Starts new horizontal pane
   Ctrl-b % # New vertical pane
   Ctrl-b o # Switch pane
   Ctrl-b Pg Up/Down # Scroll up/down in current pane
   Ctrl-b x # Quit pane
   Ctrl-b c # Create window
   Ctrl-b 0-9 # Switch to window number
   Ctrl-b , # Rename current window
   Ctrl-b & # Kill current window
   ```

6. To paste without messing up alignment in vim do `:set paste`

7. Tips for Alpine environment

   ```text
   # Add source ~/.bashrc to /etc/profile
   # Add the bash-completion for k into ~/.bashrc
   # Set TERM=xterm-256color
   # Check there is set paste in ~/.vimrc
   ```
   
8. Remember to check whether the correct dirs are mounted apart from the arguments specified to the control plane pods